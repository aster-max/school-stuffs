# -------------------------------------------------------
CREATE DATABASE MNURIKHSAN_UTS

CREATE TABLE TB_PRODI (
	KODE_PRODI VARCHAR(10) NOT NULL PRIMARY KEY,
	NAMA_PRODI VARCHAR(35) NOT NULL
);

CREATE TABLE TB_MATAKULIAH (
	KODE_MATKUL VARCHAR(10) NOT NULL PRIMARY KEY,
	NAMA_MATKUL VARCHAR(35) NOT NULL
);

CREATE TABLE TB_MAHASISWA (
	NIM INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	NAMA VARCHAR(25) NOT NULL,
	JENIS_KELAMIN ENUM('P','W') NOT NULL,
	ASAL_KOTA VARCHAR(15) NOT NULL,
	KODE_PRODI VARCHAR(10) NOT NULL,
	FOREIGN KEY (KODE_PRODI) REFERENCES TB_PRODI(KODE_PRODI)
);

CREATE TABLE TB_DOSEN (
	NIK INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	NAMA VARCHAR(25) NOT NULL,
	JENIS_KELAMIN ENUM('P','W') NOT NULL,
	ASAL_KOTA VARCHAR(15) NOT NULL,
	KODE_PRODI VARCHAR(10) NOT NULL,
	FOREIGN KEY (KODE_PRODI) REFERENCES TB_PRODI(KODE_PRODI)
);

CREATE TABLE TB_JADWAL_KULIAH (
	KODE_KELAS VARCHAR(10) NOT NULL PRIMARY KEY,
	HARI VARCHAR(10) NOT NULL,
	JAM_MULAI TIME NOT NULL,
	JAM_AKHIR TIME NOT NULL,
	RUANGAN VARCHAR(10) NOT NULL,
	NIK INT NOT NULL,
	KODE_MATKUL VARCHAR(10) NOT NULL,
	SEMESTER VARCHAR(10),
	TA VARCHAR(10),
	FOREIGN KEY (NIK) REFERENCES TB_DOSEN(NIK),
	FOREIGN KEY (KODE_MATKUL) REFERENCES TB_MATAKULIAH(KODE_MATKUL)
);

CREATE TABLE TB_NILAI_MATKUL (
	INC INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	KODE_KELAS VARCHAR(10) NOT NULL,
	NIM INT NOT NULL,
	NILAI VARCHAR(2) NOT NULL,
	CONSTRAINT FK_KODE_KELAS FOREIGN KEY (KODE_KELAS) REFERENCES TB_JADWAL_KULIAH(KODE_KELAS),
	CONSTRAINT FK_NIM FOREIGN KEY (NIM) REFERENCES TB_MAHASISWA(NIM)
);

# -------------------------------------------------------
ALTER TABLE TB_MAHASISWA
AUTO_INCREMENT = 17108020;

ALTER TABLE TB_DOSEN
AUTO_INCREMENT = 131015;

ALTER TABLE TB_NILAI_MATKUL
AUTO_INCREMENT = 1;
# -------------------------------------------------------
INSERT INTO TB_PRODI VALUES
('SI','Sistem Informasi'),
('AKT','Akutansi'),
('MNJ','Manajemen'),
('ITP','Ilmu Teknologi Pangan');

INSERT INTO TB_MATAKULIAH VALUES
('SIF1201','Basisdata Lanjut'),
('SIF1301','Metodologi Penelitian'),
('AKT1102','Perpajakan'),
('MNJ11012','Manajemen Bisnis');

INSERT INTO TB_MAHASISWA VALUES
(NULL,'Bowo','P','Bogor','SI'),
(NULL,'Budi','P','Bandung','SI'),
(NULL,'Arif','P','Jakarta','AKT'),
(NULL,'Fitri','W','Jakarta','SI'),
(NULL,'Yanti','W','Bekasi','SI'),
(NULL,'Fitri','W','Bogor','AKT'),
(NULL,'Aira','W','Bogor','AKT'),
(NULL,'Aisya','W','Bandung','AKT'),
(NULL,'Ihsan','P','Jakarta','SI');

INSERT INTO TB_DOSEN VALUES
(NULL,'Rudi','P','Jakarta','SI'),
(NULL,'Budi','P','Jakarta','AKT'),
(NULL,'Suryowati','W','Bekasi','MNJ'),
(NULL,'Wati','W','Bogor','ITP');

INSERT INTO TB_JADWAL_KULIAH VALUES
('A3001','SENIN','07:45:00','10:15:00','LAB 2',131015,'SIF1201','GANJIL','2020-2021'),
('A3002','RABU','10:30:00','13:00:00','103',131016,'AKT1102','GANJIL','2020-2021'),
('A3003','RABU','10:30:00','13:00:00','104',131017,'MNJ11012','GENAP','2019-2020');

INSERT INTO TB_NILAI_MATKUL VALUES
(NULL,'A3001',17108020,'A'),
(NULL,'A3001',17108021,'B'),
(NULL,'A3001',17108023,'C-'),
(NULL,'A3001',17108024,'C'),
(NULL,'A3001',17108028,'B'),
(NULL,'A3002',17108022,'B'),
(NULL,'A3002',17108025,'D'),
(NULL,'A3002',17108026,'A'),
(NULL,'A3002',17108027,'A');

# -----------------------------------------------------
SELECT MW.NIM, MW.NAMA, PR.NAMA_PRODI
FROM TB_NILAI_MATKUL NM
INNER JOIN TB_MAHASISWA MW ON NM.NIM = MW.NIM
INNER JOIN TB_PRODI PR ON MW.KODE_PRODI = PR.KODE_PRODI
WHERE NM.NILAI = 'A';

SELECT MW.NAMA, MW.ASAL_KOTA, PR.NAMA_PRODI
FROM TB_NILAI_MATKUL NM
INNER JOIN TB_MAHASISWA MW ON NM.NIM = MW.NIM
INNER JOIN TB_PRODI PR ON MW.KODE_PRODI = PR.KODE_PRODI
WHERE NM.NILAI IN ('C','C-','D','D-','E');

SELECT MW.NAMA, PR.NAMA_PRODI, NM.NILAI,
CASE 
	WHEN NM.NILAI LIKE 'A%' THEN 'LULUS'
	WHEN NM.NILAI LIKE 'B%' THEN 'LULUS'
	WHEN NM.NILAI LIKE 'C' THEN 'LULUS'
	ELSE 'TIDAK LULUS'
END AS 'KETERANGAN'
FROM TB_NILAI_MATKUL NM
INNER JOIN TB_MAHASISWA MW ON NM.NIM = MW.NIM
INNER JOIN TB_PRODI PR ON MW.KODE_PRODI = PR.KODE_PRODI
ORDER BY NM.NILAI;

